<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Pedagógico TeleEducación - TulaSalud</title>
    <!-- Incluye Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- html2pdf.js ya no es necesario -->
    <style>
        /* Estilos generales */
        body {
            font-family: 'Inter', sans-serif; /* Fuente moderna y legible */
            background-color: #1A1A1A; /* Negro profundo para el fondo */
            color: #E0E0E0; /* Blanco suave para el texto */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinea al inicio verticalmente */
            min-height: 100vh;
            box-sizing: border-box; /* Incluye padding en el tamaño total */
        }

        .container {
            background-color: #282828; /* Un gris oscuro elegante */
            border-radius: 12px; /* Esquinas más redondeadas */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); /* Sombra más pronunciada */
            padding: 30px;
            width: 100%;
            max-width: 900px; /* Ancho máximo para escritorio */
            box-sizing: border-box;
            text-align: center;
            margin-bottom: 40px; /* Espacio para el contenido debajo */
        }

        /* Estilos para el logo en el encabezado */
        .header-logo {
            margin-bottom: 20px; /* Espacio debajo del logo */
        }

        .header-logo img {
            max-width: 120px; /* Tamaño máximo para el logo en escritorio */
            height: auto; /* Mantiene la proporción */
            border-radius: 50%; /* Hace la imagen circular si es cuadrada */
            border: 3px solid #00BFFF; /* Borde de color de acento */
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5); /* Sombra luminosa */
            display: block; /* Para centrar con margin auto */
            margin: 0 auto; /* Centra la imagen */
        }

        h1 {
            color: #00BFFF; /* Azul claro para el título, un toque de color */
            margin-bottom: 25px;
            font-size: 2.2em;
            font-weight: 700;
        }

        p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #B0B0B0; /* Gris más claro para párrafos */
        }

        /* Área de subida de archivos */
        .upload-area {
            border: 3px dashed #444444; /* Borde punteado más oscuro */
            border-radius: 10px;
            padding: 40px 20px;
            margin-bottom: 30px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .upload-area:hover {
            background-color: #3A3A3A; /* Fondo ligeramente más claro al pasar el ratón */
            border-color: #00BFFF; /* Resalta el borde al pasar el ratón */
        }

        .upload-area i {
            font-size: 3.5em; /* Icono más grande */
            color: #00BFFF;
            margin-bottom: 15px;
        }

        .upload-area p {
            margin: 0;
            font-size: 1.2em;
            color: #E0E0E0;
        }

        #fileInput {
            display: none; /* Oculta el input de archivo por defecto */
        }

        /* Grupo de botones principales (Analizar, LLM features) */
        .button-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Permite que los botones se envuelvan */
            gap: 15px; /* Espacio entre los botones */
            margin-top: 20px;
            margin-bottom: 20px; /* Para separar de los resultados */
        }

        /* Estilos base para todos los botones */
        .upload-button, .llm-feature-button, .action-button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            color: white; /* Color de texto por defecto para la mayoría de botones */
        }

        /* Estilo para el botón de 'Analizar Archivo' */
        .upload-button {
            background-color: #007BFF; /* Azul principal */
        }
        .upload-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        /* Estilo para los botones de funciones LLM */
        .llm-feature-button {
            background-color: #8A2BE2; /* Púrpura para funciones de IA */
            margin-top: 0; /* Asegura que el margen se gestione por el gap del button-group */
        }
        .llm-feature-button:hover {
            background-color: #6A1AAB;
        }

        /* Estilos para los botones de acción al final */
        .action-button {
            /* Colores definidos más abajo para cada tipo de botón */
            margin: 10px; /* Margen para asegurar separación en flex-wrap */
        }
        .action-button:hover {
            transform: translateY(-2px);
        }

        /* Colores específicos para los botones de acción */
        .action-button.reset-button {
            background-color: #0060B0; /* Azul oscuro para 'Cargar otro archivo' */
            color: #E0E0E0;
        }
        .action-button.reset-button:hover {
            background-color: #004F90;
        }

        .action-button.close-button {
            background-color: #A03030; /* Rojo apagado para 'Cerrar' */
            color: #E0E0E0;
        }
        .action-button.close-button:hover {
            background-color: #8C2A2A;
        }

        /* Indicador de carga general */
        .loading-indicator, .llm-loading-indicator {
            display: none; /* Oculto por defecto */
            margin-top: 30px;
            font-size: 1.2em;
            color: #00BFFF;
        }

        .loading-indicator .spinner, .llm-loading-indicator .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #00BFFF;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Área de resultados */
        .results-area {
            background-color: #333333; /* Un gris más oscuro para la caja de resultados */
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            text-align: left;
            border: 1px solid #444444; /* Borde sutil */
        }

        .results-area h2 {
            color: #00BFFF;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 1px solid #444444;
            padding-bottom: 10px;
        }

        .results-area p {
            margin-bottom: 10px;
            color: #D0D0D0;
        }

        .results-area ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0;
            color: #D0D0D0;
        }

        .results-area ul li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .llm-output-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #555555;
        }

        .llm-output-section h3 {
            color: #8A2BE2; /* Púrpura para los títulos de la IA */
            margin-bottom: 10px;
        }

        /* Contenedor para los botones de acción post-análisis */
        .action-buttons-after-analysis {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Permite que los botones se envuelvan en pantallas pequeñas */
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #444444;
            display: none; /* Oculto por defecto, se muestra con JS */
        }


        /* Footer */
        .footer {
            margin-top: 30px;
            font-size: 0.85em;
            color: #888888; /* Gris más claro para el texto del footer */
        }

        /* Media Queries para responsividad */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .header-logo img {
                max-width: 100px; /* Ajuste para tablets */
            }
            h1 {
                font-size: 1.8em;
            }
            .upload-area {
                padding: 30px 15px;
                min-height: 150px;
            }
            .upload-area i {
                font-size: 2.8em;
            }
            .upload-area p {
                font-size: 1em;
            }
            .button-group .upload-button,
            .button-group .llm-feature-button {
                width: calc(50% - 15px); /* Dos botones por fila */
                margin: 0; /* Reset margin from general rules */
            }
            .button-group {
                gap: 15px; /* Ensure gap is applied */
            }
            .action-buttons-after-analysis {
                flex-direction: column; /* Apila los botones en columnas */
                gap: 10px; /* Espacio entre botones apilados */
            }
            .action-buttons-after-analysis .action-button {
                width: calc(100% - 20px); /* Ocupa casi todo el ancho en columnas */
                margin: 0; /* Reset margin from general rules, use gap from parent */
            }
            .results-area {
                padding: 20px;
            }
            .results-area h2 {
                font-size: 1.4em;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .header-logo img {
                max-width: 80px; /* Ajuste para móviles */
            }
            h1 {
                font-size: 1.5em;
            }
            .upload-area {
                padding: 25px 10px;
                min-height: 120px;
            }
            .upload-area i {
                font-size: 2.2em;
            }
            .upload-area p {
                font-size: 0.9em;
            }
            .button-group {
                flex-direction: column; /* Apila todos los botones en columnas */
                gap: 10px;
            }
            .button-group .upload-button,
            .button-group .llm-feature-button,
            .action-buttons-after-analysis .action-button {
                width: calc(100% - 20px); /* Botón de ancho completo en móvil */
                padding: 12px;
                margin: 0; /* Sin margen lateral */
            }
            .results-area {
                padding: 15px;
            }
            .results-area h2 {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Contenedor para el logo en el encabezado -->
        <div class="header-logo">
            <img src="https://pbs.twimg.com/profile_images/535655953480175616/D5VRHaDd_400x400.jpeg"
                 alt="Logo de TulaSalud"
                 onerror="this.onerror=null; this.src='https://placehold.co/400x400/8A2BE2/FFFFFF?text=Logo';" />
        </div>

        <h1><i class="fas fa-brain"></i> Analizador Pedagógico TeleEducación - TulaSalud</h1>
        <p>Sube tus archivos PDF, imágenes o presentaciones para un análisis impulsado por IA.</p>

        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Arrastra y suelta tu archivo aquí, o haz click para seleccionar</p>
            <input type="file" id="fileInput" accept=".pdf, image/jpeg, image/png, .ppt, .pptx">
        </div>

        <div class="button-group">
            <button class="upload-button" id="analyzeButton" disabled>Analizar Archivo</button>
        </div>

        <div class="loading-indicator" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Analizando archivo con el Modelo de IA...</p>
        </div>

        <div class="results-area" id="resultsArea" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Resultados del Análisis</h2>
            <div id="analysisContent"></div>
            <!-- Nuevo indicador de carga para las funciones LLM -->
            <div class="llm-loading-indicator" id="llmLoadingIndicator">
                <div class="spinner"></div>
                <p>Generando contenido con IA...</p>
            </div>
            <div id="llmOutput" class="llm-output-section">
                <!-- Aquí se mostrarán los resultados del LLM -->
            </div>
        </div>

        <!-- Nuevos botones de acción que se muestran después del análisis -->
        <div class="action-buttons-after-analysis" id="actionButtons">
            <button class="action-button reset-button" id="resetButton"><i class="fas fa-redo"></i> Cargar otro archivo</button>
            <button class="action-button close-button" id="closePageButton"><i class="fas fa-times-circle"></i> Cerrar Página</button>
        </div>

        <div class="footer">
            <p>© 2025 Lic. Luis Ygnacio Ponce Sierra | Todos los derechos reservados</p>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const analyzeButton = document.getElementById('analyzeButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsArea = document.getElementById('resultsArea');
        const analysisContent = document.getElementById('analysisContent');
        const llmLoadingIndicator = document.getElementById('llmLoadingIndicator');
        const llmOutput = document.getElementById('llmOutput');
        const actionButtons = document.getElementById('actionButtons');
        const resetButton = document.getElementById('resetButton');
        const closePageButton = document.getElementById('closePageButton');
        const container = document.querySelector('.container'); // Referencia al contenedor para mensajes

        let selectedFile = null;

        // Previene el comportamiento por defecto de arrastrar y soltar
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // También para el body
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Resalta el área al arrastrar el archivo
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.style.borderColor = '#00BFFF', false);
        });

        // Vuelve al borde normal al salir del área
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.style.borderColor = '#444444', false);
        });

        // Maneja la caída del archivo
        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            // Asegura que solo se procese un archivo
            if (files.length > 0) {
                handleFileSelection(files[0]);
            }
        }

        // Abre el explorador de archivos al hacer click en el área de subida
        uploadArea.addEventListener('click', () => fileInput.click());

        // Maneja la selección de archivos desde el input
        fileInput.addEventListener('change', (e) => {
            // Asegura que solo se procese un archivo
            if (e.target.files.length > 0) {
                handleFileSelection(e.target.files[0]);
            }
        });

        /**
         * Maneja el archivo seleccionado, actualiza el UI y habilita el botón de análisis.
         * Esta función se llama cuando se selecciona un nuevo archivo.
         * @param {File} file - El archivo seleccionado.
         */
        function handleFileSelection(file) {
            selectedFile = file;
            // Muestra el nombre del archivo en el área de subida
            uploadArea.querySelector('p').textContent = `Archivo seleccionado: ${selectedFile.name}`;
            analyzeButton.disabled = false; // Habilita el botón de analizar

            // Resetea el estado de la UI para un nuevo archivo, pero manteniendo el archivo seleccionado
            resultsArea.style.display = 'none';
            llmOutput.innerHTML = '';
            loadingIndicator.style.display = 'none';
            llmLoadingIndicator.style.display = 'none';
            actionButtons.style.display = 'none';
            // Asegura que el área de subida y el botón de análisis estén visibles
            uploadArea.style.display = 'flex';
            analyzeButton.style.display = 'block';
        }

        // Maneja el clic en el botón de analizar
        analyzeButton.addEventListener('click', () => {
            if (selectedFile) {
                startAnalysis(selectedFile);
            } else {
                // Usamos un modal o un mensaje dentro de la página en lugar de alert()
                displayMessage("Por favor, selecciona un archivo para analizar.", "error");
            }
        });

        /**
         * Simula el proceso de análisis inicial de un archivo por una IA.
         * @param {File} file - El archivo a "analizar".
         */
        function startAnalysis(file) {
            // Oculta el área de subida y muestra el indicador de carga
            uploadArea.style.display = 'none';
            analyzeButton.style.display = 'none';
            loadingIndicator.style.display = 'block';
            resultsArea.style.display = 'none'; // Asegura que los resultados estén ocultos
            llmOutput.innerHTML = ''; // Limpia el contenido LLM anterior
            actionButtons.style.display = 'none'; // Oculta los botones de acción mientras se analiza

            // Simula el proceso de análisis inicial
            setTimeout(() => {
                let initialAnalysis = '';
                let llmButtons = '';

                // El contenido del análisis inicial se mantiene igual
                if (file.type.includes('pdf')) {
                    initialAnalysis = `
                        <p><strong>Tipo de Archivo:</strong> Documento PDF</p>
                        <p><strong>Evaluación Pedagógica del Contenido:</strong></p>
                        <ul>
                            <li><strong>Claridad Conceptual:</strong> <span style="color:#28a745;">Alta.</span> Las definiciones y conceptos clave parecen estar bien explicados.</li>
                            <li><strong>Estructura y Flujo:</strong> <span style="color:#ffc107;">Media.</span> La organización general es lógica, pero algunas transiciones entre secciones podrían ser más fluidas.</li>
                            <li><strong>Complejidad del Lenguaje:</strong> <span style="color:#28a745;">Adecuada.</span> El léxico y la sintaxis son apropiados para un público de jóvenes y adultos, evitando jerga excesiva.</li>
                            <li><strong>Uso de Ejemplos/Analogías:</strong> <span style="color:#ffc107;">Suficiente.</span> Se identifican algunos ejemplos, pero la incorporación de más casos prácticos podría mejorar la comprensión.</li>
                            <li><strong>Relevancia de Elementos Visuales:</strong> <span style="color:#28a745;">Buena.</span> Las imágenes o gráficos detectados apoyan el texto de manera efectiva.</li>
                        </ul>
                        <p><strong>Observaciones de Mejora (Alineada con políticas educativas guatemaltecas para jóvenes y adultos):</p>
                        <ul>
                            <li><strong>1. Contextualización Local:</strong> Integrar ejemplos y referencias socioculturales guatemaltecas (ej. casos de estudio de comunidades, desafíos locales) para aumentar la relevancia del contenido según los principios del Currículo Nacional Base (CNB) para jóvenes y adultos.</li>
                            <li><strong>2. Andragogía Aplicada:</strong> Asegurar que el material fomente el aprendizaje autodirigido y se conecte con las experiencias previas de los adultos, un pilar fundamental en la educación de personas jóvenes y adultas.</li>
                            <li><strong>3. Interacción y Participación Activa:</strong> Incorporar más actividades interactivas, preguntas de debate o escenarios de resolución de problemas que promuevan la participación activa, en consonancia con las metodologías participativas sugeridas en las políticas educativas.</li>
                            <li><strong>4. Claridad en Objetivos de Aprendizaje:</strong> Establecer objetivos de aprendizaje claros y alcanzables al inicio de cada sección, que resuenen con las necesidades y metas de los estudiantes adultos.</li>
                            <li><strong>5. Resúmenes Prácticos:</strong> Incluir resúmenes concisos al final de cada unidad, enfocados en la aplicación práctica del conocimiento en la vida diaria o laboral, un aspecto valorado en la educación para adultos.</li>
                            <li><strong>6. Lenguaje Inclusivo y Accesible:</strong> Revisar el lenguaje para garantizar que sea inclusivo, respetuoso de la diversidad cultural y lingüística de Guatemala, y accesible para diferentes niveles de alfabetización.</li>
                            <li><strong>7. Elementos Visuales con Propósito Pedagógico:</strong> Optimizar los elementos visuales (gráficos, imágenes) para que no solo decoren, sino que expliquen conceptos complejos o ilustren situaciones relevantes para la audiencia.</li>
                            <li><strong>8. Fomento del Pensamiento Crítico:</strong> Diseñar actividades o preguntas que inviten al análisis crítico de la información y a la formación de una opinión propia, en línea con el desarrollo de competencias del CNB.</li>
                            <li><strong>9. Orientación a la Resolución de Problemas:</strong> Estructurar el contenido de manera que los temas se presenten como problemas a resolver, permitiendo a los estudiantes aplicar sus conocimientos para encontrar soluciones.</li>
                            <li><strong>10. Retroalimentación Formativa:</strong> Sugerir la implementación de mecanismos de autoevaluación o mini-ejercicios con retroalimentación inmediata, para que los estudiantes puedan monitorear su propio progreso y ajustar su aprendizaje.</li>
                            <li><strong>11. Pertinencia Sociocultural:</strong> Asegurar que el contenido refleje la realidad sociocultural de Guatemala, incluyendo referencias a su historia, geografía, tradiciones y desafíos actuales.</li>
                            <li><strong>12. Adaptabilidad de Formato:</strong> Considerar formatos alternativos (ej. audio, video, infografías interactivas) para segmentos del contenido que puedan beneficiarse de una presentación multimodal, mejorando la accesibilidad y el engagement.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="generateComprehensionQuestions()">Generar Preguntas de Comprensión ✨</button>';
                } else if (file.type.includes('image')) {
                    initialAnalysis = `
                        <p><strong>Tipo de Archivo:</strong> Archivo de Imagen (${file.type.split('/')[1].toUpperCase()})</p>
                        <p><strong>Análisis Pedagógico Visual (simulada):</strong></p>
                        <ul>
                            <li><strong>Claridad y Propósito:</strong> <span style="color:#28a745;">Alta.</span> La imagen parece clara y su propósito comunicativo (ilustrar, explicar, decorar) es evidente.</li>
                            <li><strong>Relevancia Contextual:</strong> <span style="color:#ffc107;">Media.</span> La imagen podría ser relevante para el contexto pedagógico, pero su conexión explícita con un tema específico podría fortalecerse con un pie de foto más descriptivo o un texto que la referencie directamente.</li>
                            <li><strong>Calidad y Legibilidad:</strong> <span style="color:#28a745;">Buena.</span> La resolución y el contraste son adecuados. Si contiene texto, este es legible.</li>
                            <li><strong>Impacto Didáctico:</strong> <span style="color:#ffc107;">Potencial.</span> La imagen tiene potencial para ser una herramienta didáctica, pero se beneficiaría de un pequeño análisis de los puntos clave o preguntas que dirijan la atención del estudiante.</li>
                        </ul>
                        <p><strong>Observaciones de Mejora (simulada y alineada con principios pedagógicos):</p>
                        <ul>
                            <li><strong>1. Pie de Foto Contextualizado:</strong> El pie de foto debe no solo describir la imagen, sino vincularla directamente al concepto pedagógico que ilustra y a la realidad guatemalteca si es pertinente.</li>
                            <li><strong>2. Metáfora Visual Explícita:</strong> Si la imagen es una metáfora, considerar añadir una breve explicación de cómo se relaciona con el tema para facilitar la comprensión abstracta de jóvenes y adultos.</li>
                            <li><strong>3. Accesibilidad Visual:</strong> Asegurar que la imagen tenga un "texto alternativo" (alt text) descriptivo para lectores de pantalla, cumpliendo con las normas de accesibilidad educativa.</li>
                            <li><strong>4. Impacto Cultural:</strong> Evaluar si la imagen representa de manera sensible y apropiada la diversidad cultural de Guatemala, o si podría contextualizarse mejor para reflejarla.</li>
                            <li><strong>5. Claridad de Información:</strong> Si la imagen contiene gráficos o diagramas, verificar que la información sea legible, sin sobrecarga, y que las etiquetas sean claras y concisas.</li>
                            <li><strong>6. Función Didáctica Clara:</strong> Cada imagen debe tener un objetivo didáctico claro (ej. ilustrar un proceso, comparar elementos, contextualizar un concepto) y esto debe ser evidente para el estudiante.</li>
                            <li><strong>7. Evitar Estereotipos:</strong> Analizar la imagen para identificar y eliminar posibles estereotipos culturales, de género o sociales que puedan estar presentes.</li>
                            <li><strong>8. Calidad para Impresión/Digital:</strong> Asegurar que la resolución de la imagen sea adecuada tanto para visualización en pantalla como para una posible impresión, sin pixelado excesivo.</li>
                            <li><strong>9. Preguntas Guía en la Imagen:</strong> Integrar pequeñas preguntas directamente relacionadas con la imagen (si el formato lo permite) para fomentar la observación activa y el pensamiento crítico.</li>
                            <li><strong>10. Integración con el Texto:</strong> La imagen debe estar estratégicamente ubicada cerca del texto al que hace referencia, para mantener la coherencia y evitar distracciones.</li>
                            <li><strong>11. Relevancia y Actualidad:</strong> Verificar que la imagen sea actual y relevante para la temática y la audiencia, evitando elementos desactualizados que puedan desmotivar.</li>
                            <li><strong>12. Optimización de Peso:</strong> Optimizar el tamaño de archivo de la imagen para asegurar una carga rápida en entornos con conectividad limitada, común en algunas zonas de Guatemala.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="generateDetailedImageDescription()">Generar Descripción Detallada ✨</button>';
                } else if (file.type.includes('presentation') || file.type.includes('powerpoint')) {
                    fileType = 'Presentación (PPT/PPTX)';
                    initialAnalysis = `
                        <p><strong>Tipo de Archivo:</strong> ${fileType}</p>
                        <p><strong>Análisis Pedagógico de Presentación (simulada):</strong></p>
                        <ul>
                            <li><strong>Estructura Lógica:</strong> <span style="color:#28a745;">Buena.</span> La secuencia de diapositivas parece seguir un orden coherente, con una clara introducción y desarrollo.</li>
                            <li><strong>Densidad de Información por Diapositiva:</strong> <span style="color:#ffc107;">Media.</span> Algunas diapositivas podrían contener demasiada información textual, lo que podría dificultar la retención para la audiencia.</li>
                            <li><strong>Coherencia Visual:</strong> <span style="color:#28a745;">Adecuada.</span> Se observa un estilo visual consistente (fuentes, colores, layouts).</li>
                            <li><strong>Uso de Elementos Multimedia:</strong> <span style="color:#ffc107;">Suficiente.</span> Si hay videos o audios, están bien integrados, pero se podrían explorar más recursos interactivos.</li>
                            <li><strong>Apoyo Visual al Discurso:</strong> <span style="color:#28a745;">Efectivo.</span> Las imágenes y gráficos complementan el mensaje principal de las diapositivas.</li>
                        </ul>
                        <p><strong>Observaciones de Mejora (simulada y alineada con políticas educativas guatemaltecas para jóvenes y adultos):</p>
                        <ul>
                            <li><strong>1. Principio de Claridad (Pocos Puntos por Diapositiva):</strong> Reducir la densidad textual en las diapositivas (máx. 6-8 líneas, no frases completas), priorizando los puntos clave y el apoyo visual para facilitar el seguimiento de jóvenes y adultos.</li>
                            <li><strong>2. Fomento de la Interacción Activa:</strong> Integrar momentos para preguntas, debates o actividades prácticas que promuevan la participación y el intercambio de experiencias, acorde a la andragogía.</li>
                            <li><strong>3. Inclusión y Diversidad:</strong> Asegurar que las imágenes, ejemplos y lenguaje reflejen la diversidad cultural y lingüística de Guatemala, evitando sesgos y promoviendo la equidad.</li>
                            <li><strong>4. Estructura Lógica y Navegación:</strong> Fortalecer el hilo conductor entre diapositivas y, si es extenso, incluir una agenda o barra de progreso visual para orientar al estudiante.</li>
                            <li><strong>5. Ejemplos Relevantes y Contextualizados:</strong> Utilizar ejemplos y casos de estudio que sean pertinentes a la realidad guatemalteca y a las experiencias de vida de los jóvenes y adultos.</li>
                            <li><strong>6. Diseño de Información Limpio:</strong> Optimizar el uso del espacio en blanco, el tamaño de la fuente y los contrastes de color para maximizar la legibilidad y minimizar la fatiga visual.</li>
                            <li><strong>7. Llamadas a la Acción Educativas:</strong> Si la presentación busca una acción, guiar claramente al estudiante hacia ella (ej. "Aplica esto en tu comunidad", "Reflexiona sobre X").</li>
                            <li><strong>8. Adaptabilidad para Modos de Aprendizaje:</strong> Considerar que la presentación pueda ser utilizada de forma autodirigida o con un facilitador, y que sea efectiva en ambos escenarios.</li>
                            <li><strong>9. Evaluación Formativa Integrada:</strong> Incluir pequeñas preguntas de autoevaluación o momentos para la reflexión personal que permitan al estudiante verificar su comprensión durante la presentación.</li>
                            <li><strong>10. Uso Estratégico de Multimedia:</strong> Incorporar videos cortos, audios o infografías interactivas (si el entorno lo permite) para explicar conceptos complejos de forma más dinámica y atractiva.</li>
                            <li><strong>11. Coherencia con Competencias:</strong> Alinear el contenido y los objetivos de cada diapositiva con las competencias clave establecidas en el Currículo Nacional Base para la educación de adultos.</li>
                            <li><strong>12. Guía para el Facilitador:</strong> Si la presentación está diseñada para ser guiada, se podría añadir (internamente o en notas) sugerencias para el facilitador sobre cómo expandir cada punto y moderar la discusión.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="suggestSpeakerPoints()">Sugerir Puntos Clave para el Orador ✨</button>';
                } else {
                    initialAnalysis = `<p><strong>Tipo de Archivo:</strong> Tipo de archivo desconocido</p><p>Lo siento, el Analizador Pedagógico TeleEducación no puede procesar este tipo de archivo en este momento. Por favor, sube un PDF, una imagen o una presentación (PPT/PPTX).</p>`;
                }

                // Oculta el indicador de carga principal y muestra los resultados
                loadingIndicator.style.display = 'none';
                
                // Estos elementos solo se muestran DESPUÉS de que el análisis inicial haya terminado
                uploadArea.style.display = 'flex'; 
                analyzeButton.style.display = 'block'; 
                analyzeButton.disabled = true; // Deshabilita hasta nueva selección
                uploadArea.querySelector('p').textContent = 'Arrastra y suelta tu archivo aquí, o haz click para seleccionar'; 
                fileInput.value = ''; 
                selectedFile = null; // Reinicia el archivo seleccionado para evitar re-análisis sin nueva selección

                analysisContent.innerHTML = initialAnalysis + '<div class="llm-feature-buttons button-group">' + llmButtons + '</div>'; 
                resultsArea.style.display = 'block'; 
                actionButtons.style.display = 'flex'; 
            }, 3000); // Simula un retraso de 3 segundos para el análisis inicial
        }

        /**
         * Simula la generación de preguntas de comprensión con un LLM (para PDF).
         */
        function generateComprehensionQuestions() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const questions = [
                    "¿Cuál es el objetivo principal del documento y a quién está dirigido específicamente dentro del contexto guatemalteco?",
                    "Explica con tus propias palabras al menos dos conceptos clave presentados en el texto, y cómo se relacionan con tu experiencia o la realidad de tu comunidad.",
                    "Identifica y describe un ejemplo o caso práctico que se utilice para ilustrar un concepto complejo. ¿Podrías pensar en un ejemplo similar de tu entorno?",
                    "Según el documento, ¿qué elementos visuales (gráficos, imágenes, infografías) son más efectivos para la comprensión del tema para jóvenes y adultos, y por qué?",
                    "Si tuvieras que mejorar una sección del documento para una mayor claridad y pertinencia cultural, ¿cuál sería y qué cambio harías?",
                    "¿Qué preguntas adicionales te surgen después de leer este contenido que el documento no aborda completamente, especialmente en relación con desafíos o oportunidades en Guatemala?",
                    "¿Cómo crees que la estructura del documento (ej. uso de títulos, subtítulos, viñetas, resúmenes) ayuda o dificulta la comprensión para un aprendizaje autodirigido?",
                    "Si fueras a enseñar este tema a alguien en tu comunidad, ¿qué parte del documento usarías como punto de partida y qué adaptarías para su contexto?",
                    "¿Qué tipo de recurso complementario (video breve, infografía sobre un caso local, simulación sencilla) crees que sería más útil para profundizar en este documento, alineado con las modalidades de teleeducación?",
                    "Identifica una fortaleza clave en el diseño de la información o en el enfoque pedagógico del documento que facilite el aprendizaje de jóvenes y adultos en el contexto guatemalteco."
                ];
                let output = '<h3>Preguntas de Comprensión Sugeridas por IA ✨</h3><ul>';
                questions.forEach(q => { output += `<li>${q}</li>`; });
                output += '</ul><p><em>Estas preguntas buscan evaluar la comprensión profunda y crítica del contenido, con un enfoque en la relevancia para jóvenes y adultos en el contexto educativo guatemalteco.</em></p>';
                llmOutput.innerHTML = output;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso de 2.5 segundos para la generación de preguntas
        }

        /**
         * Simula la generación de una descripción detallada de imagen con un LLM.
         */
        function generateDetailedImageDescription() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const description = `
                    <h3>Descripción Detallada de Imagen Sugerida por IA ✨</h3>
                    <p>La IA interpreta esta imagen como una representación altamente conceptual de un entorno de aprendizaje dinámico, probablemente en el ámbito de la teleeducación. Se observa una paleta de colores que evoca profesionalismo y claridad, con elementos que sugieren interconexión y flujo de información.</p>
                    <p><strong>Análisis Pedagógico Visual y Contextual:</strong></p>
                    <ul>
                        <li><strong>Propósito Didáctico:</strong> La imagen sirve como metáfora visual para el proceso de aprendizaje digital, enfatizando la interacción de ideas y la conectividad, un concepto clave en la teleeducación moderna.</li>
                        <li><strong>Relevancia para Jóvenes y Adultos:</strong> Su diseño moderno y limpio puede ser atractivo para la audiencia de jóvenes y adultos, sugiriendo un enfoque innovador en la educación.</li>
                        <li><strong>Conexión Contextual (Guatemala):</strong> La abstracción permite que la imagen sea adaptable, pero se podría sugerir una variante que incorpore sutilmente elementos visuales propios del entorno guatemalteco (ej., patrones textiles, paisajes, etc.) para mayor identificación.</li>
                        <li><strong>Accesibilidad y Claridad:</strong> La simplicidad de las formas y los contrastes de color facilitan la percepción visual. Se recomienda verificar que no haya elementos que puedan confundir a personas con ciertas discapacidades visuales.</li>
                        <li><strong>Potencial de Discusión:</strong> La imagen puede ser un excelente punto de partida para discutir cómo la tecnología facilita el acceso al conocimiento y la interconexión en el aprendizaje a distancia.</li>
                    </ul>
                    <p><strong>Sugerencias para el uso óptimo:</strong></p>
                    <ul>
                        <li>Integrar con un texto que la referencie explícitamente y explique la metáfora visual en el contexto de la teleeducación de jóvenes y adultos en Guatemala.</li>
                        <li>Considerar animación sutil si se usa en un entorno web para reforzar la idea de dinamismo del aprendizaje.</li>
                        <li>Utilizarla como punto de partida para una discusión sobre la "arquitectura" del conocimiento en línea y sus implicaciones para la comunidad local.</li>
                    </ul>
                `;
                llmOutput.innerHTML = description;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso
        }

        /**
         * Simula la sugerencia de puntos clave para el orador con un LLM (para PPT).
         */
        function suggestSpeakerPoints() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const points = [
                    "<strong>Diapositiva 1 (Título):</strong> 'Bienvenidos a X - El futuro de la TeleEducación en Guatemala'. Enfocarse en captar la atención con una pregunta relevante o una estadística local si es posible.",
                    "<strong>Diapositiva 2 (Agenda):</strong> 'Qué cubriremos hoy y por qué es importante para ustedes'. Mencionar los puntos principales de manera atractiva, destacando los beneficios directos para los estudiantes adultos.",
                    "<strong>Diapositva 3 (Problema/Contexto):</strong> 'El desafío actual de acceso a la educación en nuestra región...'. Presentar el problema o la necesidad que la presentación abordará, usando una anécdota o datos contextualizados a Guatemala.",
                    "<strong>Diapositiva 4 (Nuestra Solución/Concepto):</strong> 'La respuesta de TulaSalud: [Concepto clave]'. Explicar la propuesta de valor de forma clara y concisa, resaltando cómo empodera a los estudiantes adultos.",
                    "<strong>Diapositiva 5 (Metodología/Proceso):</strong> 'Cómo lo hacemos: [Pasos principales] y cómo se alinea con el aprendizaje de adultos'. Describir el proceso en 3-5 pasos sencillos, usando analogías o ejemplos de la vida real.",
                    "<strong>Diapositiva 6 (Beneficios y Aplicabilidad):</strong> 'Impacto y Resultados Clave para el desarrollo personal y comunitario'. Resaltar los beneficios tangibles, utilizando viñetas y un lenguaje persuasivo, conectándolos con las aspiraciones de la audiencia.",
                    "<strong>Diapositiva 7 (Caso de Éxito Local):</strong> 'Historias Reales de impacto en Guatemala'. Presentar un breve estudio de caso o testimonio de un estudiante o comunidad local para dar credibilidad y conectar emocionalmente.",
                    "<strong>Diapositiva 8 (Innovación Futura y Sostenibilidad):</strong> 'Mirando hacia adelante: [Nuevas características/proyectos] y cómo contribuimos al desarrollo sostenible'. Compartir la visión a futuro y cómo la plataforma seguirá evolucionando en beneficio de la educación para adultos.",
                    "<strong>Diapositiva 9 (Preguntas y Respuestas):</strong> 'Su voz es importante'. Anticipar preguntas comunes y preparar respuestas concisas, o invitar a la audiencia a preguntar, fomentando un diálogo abierto.",
                    "<strong>Diapositiva 10 (Llamada a la Acción):</strong> 'Únete a la TeleEducación del futuro hoy mismo'. Dejar claro el siguiente paso para la audiencia (ej. registrarse, contactar, explorar la plataforma), facilitando el acceso.",
                    "<strong>Diapositiva 11 (Agradecimientos y Contacto):</strong> '¡Gracias por su tiempo e interés en el futuro de la educación!'. Incluir información de contacto visible.",
                    "<strong>Diapositiva 12 (Recursos Adicionales):</strong> 'Para saber más...'. Opcional: Proporcionar enlaces, códigos QR o materiales complementarios que amplíen el tema y estén disponibles en línea."
                ];
                let output = '<h3>Puntos Clave para el Orador Sugeridos por IA ✨</h3><ul>';
                points.forEach(p => { output += `<li>${p}</li>`; });
                output += '</ul><p><em>Estos puntos son sugerencias detalladas para enriquecer tu presentación, centrándote en la claridad, el impacto pedagógico y la relevancia para la educación de jóvenes y adultos en el contexto guatemalteco.</em></p>';
                llmOutput.innerHTML = output;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso
        }

        /**
         * Reinicia el estado de la UI a su condición inicial para permitir la carga de un nuevo archivo.
         */
        function resetUIState() {
            selectedFile = null; // Resetea el archivo seleccionado
            fileInput.value = ''; // Limpia el valor del input de archivo
            uploadArea.querySelector('p').textContent = 'Arrastra y suelta tu archivo aquí, o haz click para seleccionar'; // Restablece el texto del área de subida
            analyzeButton.disabled = true; // Deshabilita el botón de analizar
            resultsArea.style.display = 'none'; // Oculta la sección de resultados
            llmOutput.innerHTML = ''; // Limpia el contenido generado por LLM
            loadingIndicator.style.display = 'none'; // Oculta el indicador de carga principal
            llmLoadingIndicator.style.display = 'none'; // Oculta el indicador de carga del LLM
            uploadArea.style.display = 'flex'; // Asegura que el área de subida sea visible
            analyzeButton.style.display = 'block'; // Asegura que el botón de análisis sea visible
            actionButtons.style.display = 'none'; // Oculta los botones de acción post-análisis
        }

        // Event listeners para los nuevos botones de acción
        resetButton.addEventListener('click', resetUIState); // Botón para cargar otro archivo (reinicia la UI)

        closePageButton.addEventListener('click', () => {
            // Intenta cerrar la ventana/pestaña del navegador.
            // Nota: La mayoría de los navegadores modernos restringen esta función
            // por seguridad, a menos que la ventana haya sido abierta por script.
            window.close();
        });

        // Función para mostrar mensajes personalizados (en lugar de alert)
        function displayMessage(message, type = "info") {
            // Eliminar cualquier mensaje existente para evitar duplicados
            const existingMessageBox = container.querySelector('.message-box');
            if (existingMessageBox) {
                existingMessageBox.remove();
            }

            // Crear un div para el mensaje
            const messageBox = document.createElement('div');
            messageBox.textContent = message;
            messageBox.className = 'message-box'; // Añadir una clase para facilitar la selección

            messageBox.style.padding = '15px';
            messageBox.style.borderRadius = '8px';
            messageBox.style.marginTop = '20px';
            messageBox.style.color = '#fff';
            messageBox.style.fontWeight = 'bold';
            messageBox.style.textAlign = 'center';

            if (type === "error") {
                messageBox.style.backgroundColor = '#DC3545'; // Rojo para errores
            } else {
                messageBox.style.backgroundColor = '#007BFF'; // Azul para información
            }

            // Añadir al contenedor principal
            container.insertBefore(messageBox, uploadArea.nextSibling); // Insertar después del área de carga

            // Eliminar el mensaje después de unos segundos
            setTimeout(() => {
                messageBox.remove();
            }, 5000);
        }
    </script>
</body>
</html>
