<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Pedagógico TeleEducación - TulaSalud</title>
    <!-- Incluye Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos generales */
        body {
            font-family: 'Inter', sans-serif; /* Fuente moderna y legible */
            background-color: #1A1A1A; /* Negro profundo para el fondo */
            color: #E0E0E0; /* Blanco suave para el texto */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinea al inicio verticalmente */
            min-height: 100vh;
            box-sizing: border-box; /* Incluye padding en el tamaño total */
            /* Cambia el cursor del ratón por la imagen de dedo.png */
            cursor: url('https://raw.githubusercontent.com/google/gemini-micro-web/main/assets/img/dedo.png'), auto;
            /* Se usa raw.githubusercontent.com para acceder directamente a la imagen.
               'auto' es el cursor de respaldo si la imagen no se carga o no es válida.
               Idealmente, la imagen del cursor debe ser pequeña (por ejemplo, 32x32px o 48x48px)
               y en formato .cur o .png con transparencia para un mejor rendimiento. */
        }

        .container {
            background-color: #282828; /* Un gris oscuro elegante */
            border-radius: 12px; /* Esquinas más redondeadas */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4); /* Sombra más pronunciada */
            padding: 30px;
            width: 100%;
            max-width: 900px; /* Ancho máximo para escritorio */
            box-sizing: border-box;
            text-align: center;
            margin-bottom: 40px; /* Espacio para el contenido debajo */
        }

        /* Estilos para el logo en el encabezado */
        .header-logo {
            margin-bottom: 20px; /* Espacio debajo del logo */
        }

        .header-logo img {
            max-width: 120px; /* Tamaño máximo para el logo en escritorio */
            height: auto; /* Mantiene la proporción */
            border-radius: 50%; /* Hace la imagen circular si es cuadrada */
            border: 3px solid #00BFFF; /* Borde de color de acento */
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5); /* Sombra luminosa */
            display: block; /* Para centrar con margin auto */
            margin: 0 auto; /* Centra la imagen */
        }

        h1 {
            color: #00BFFF; /* Azul claro para el título, un toque de color */
            margin-bottom: 25px;
            font-size: 2.2em;
            font-weight: 700;
        }

        p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #B0B0B0; /* Gris más claro para párrafos */
        }

        /* Área de subida de archivos */
        .upload-area {
            border: 3px dashed #444444; /* Borde punteado más oscuro */
            border-radius: 10px;
            padding: 40px 20px;
            margin-bottom: 30px;
            cursor: pointer; /* Cursor de puntero para indicar interactividad */
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }

        .upload-area:hover {
            background-color: #3A3A3A; /* Fondo ligeramente más claro al pasar el ratón */
            border-color: #00BFFF; /* Resalta el borde al pasar el ratón */
        }

        .upload-area i {
            font-size: 3.5em; /* Icono más grande */
            color: #00BFFF;
            margin-bottom: 15px;
        }

        .upload-area p {
            margin: 0;
            font-size: 1.2em;
            color: #E0E0E0;
        }

        #fileInput {
            display: none; /* Oculta el input de archivo por defecto */
        }

        /* Grupo de botones principales (Analizar, LLM features) */
        .button-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Permite que los botones se envuelvan */
            gap: 15px; /* Espacio entre los botones */
            margin-top: 20px;
            margin-bottom: 20px; /* Para separar de los resultados */
        }

        /* Estilos base para todos los botones */
        .upload-button, .llm-feature-button, .action-button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer; /* Cursor de puntero para acciones clicables */
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            color: white; /* Color de texto por defecto para la mayoría de botones */
        }

        /* Estilo para el botón de 'Analizar Archivo' */
        .upload-button {
            background-color: #007BFF; /* Azul principal */
        }
        .upload-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        /* Estilo para los botones de funciones LLM */
        .llm-feature-button {
            background-color: #8A2BE2; /* Púrpura para funciones de IA */
            margin-top: 0; /* Asegura que el margen se gestione por el gap del button-group */
        }
        .llm-feature-button:hover {
            background-color: #6A1AAB;
        }

        /* Estilos para los botones de acción al final */
        .action-button {
            /* Colores definidos más abajo para cada tipo de botón */
            margin: 10px; /* Margen para asegurar separación en flex-wrap */
        }
        .action-button:hover {
            transform: translateY(-2px);
        }

        /* Colores específicos para los botones de acción */
        .action-button.reset-button {
            background-color: #0060B0; /* Azul oscuro para 'Cargar otro archivo' */
            color: #E0E0E0;
        }
        .action-button.reset-button:hover {
            background-color: #004F90;
        }

        .action-button.close-button {
            background-color: #A03030; /* Rojo apagado para 'Cerrar' */
            color: #E0E0E0;
        }
        .action-button.close-button:hover {
            background-color: #8C2A2A;
        }

        /* Indicador de carga general */
        .loading-indicator, .llm-loading-indicator {
            display: none; /* Oculto por defecto */
            margin-top: 30px;
            font-size: 1.2em;
            color: #00BFFF;
        }

        .loading-indicator .spinner, .llm-loading-indicator .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #00BFFF;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Área de resultados */
        .results-area {
            background-color: #333333; /* Un gris más oscuro para la caja de resultados */
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            text-align: left;
            border: 1px solid #444444; /* Borde sutil */
        }

        /* Justifica el texto dentro de la sección de resultados (párrafos y listas) */
        .results-area p, .results-area ul, .results-area ol {
            text-align: justify; /* Justifica el texto */
        }
        .results-area ul li, .results-area ol li {
            text-align: justify; /* Asegura la justificación también en elementos de lista */
        }

        .results-area h2 {
            color: #00BFFF;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 1px solid #444444;
            padding-bottom: 10px;
        }

        .results-area p {
            margin-bottom: 10px;
            color: #D0D0D0;
        }

        .results-area ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0;
            color: #D0D0D0;
        }

        .results-area ul li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        /* NUEVOS ESTILOS PARA LAS TARJETAS DE EVALUACIÓN Y OBSERVACIONES */
        .evaluation-card, .observations-card {
            background-color: #3A3A3A; /* Un gris más claro para contraste */
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px; /* Espacio entre las tarjetas */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* Sombra suave para efecto de elevación */
            border: 1px solid #444444; /* Borde sutil */
        }

        /* Justifica el texto dentro de las tarjetas */
        .evaluation-card p, .evaluation-card ul, .evaluation-card ol {
            text-align: justify;
        }
        .evaluation-card ul li, .evaluation-card ol li {
            text-align: justify;
        }
        .observations-card p, .observations-card ul, .observations-card ol {
            text-align: justify;
        }
        .observations-card ul li, .observations-card ol li {
            text-align: justify;
        }

        .evaluation-card h3, .observations-card h3 {
            color: #00BFFF; /* Título de la evaluación y observaciones (ahora el mismo color) */
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 1px solid #555555;
            padding-bottom: 8px;
            text-align: center; /* ¡NUEVO! Centra los títulos de las tarjetas */
        }

        .llm-output-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #555555;
        }

        .llm-output-section h3 {
            color: #8A2BE2; /* Púrpura para los títulos de la IA */
            margin-bottom: 10px;
        }

        /* Contenedor para los botones de acción post-análisis */
        .action-buttons-after-analysis {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Permite que los botones se envuelvan en pantallas pequeñas */
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #444444;
            display: none; /* Oculto por defecto, se muestra con JS */
        }


        /* Footer */
        .footer {
            margin-top: 30px;
            font-size: 0.85em;
            color: #888888; /* Gris más claro para el texto del footer */
        }

        /* Media Queries para responsividad */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .header-logo img {
                max-width: 100px; /* Ajuste para tablets */
            }
            h1 {
                font-size: 1.8em;
            }
            .upload-area {
                padding: 30px 15px;
                min-height: 150px;
            }
            .upload-area i {
                font-size: 2.8em;
            }
            .upload-area p {
                font-size: 1em;
            }
            .button-group .upload-button,
            .button-group .llm-feature-button {
                width: calc(50% - 15px); /* Dos botones por fila */
                margin: 0; /* Reset margin from general rules */
            }
            .button-group {
                gap: 15px; /* Ensure gap is applied */
            }
            .action-buttons-after-analysis {
                flex-direction: column; /* Apila los botones en columnas */
                gap: 10px; /* Espacio entre botones apilados */
            }
            .action-buttons-after-analysis .action-button {
                width: calc(100% - 20px); /* Ocupa casi todo el ancho en columnas */
                margin: 0; /* Reset margin from general rules, use gap from parent */
            }
            .results-area {
                padding: 20px;
            }
            .results-area h2 {
                font-size: 1.4em;
            }
            .evaluation-card, .observations-card {
                padding: 15px;
            }
            .evaluation-card h3, .observations-card h3 {
                font-size: 1.2em;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .header-logo img {
                max-width: 80px; /* Ajuste para móviles */
            }
            h1 {
                font-size: 1.5em;
            }
            .upload-area {
                padding: 25px 10px;
                min-height: 120px;
            }
            .upload-area i {
                font-size: 2.2em;
            }
            .upload-area p {
                font-size: 0.9em;
            }
            .button-group {
                flex-direction: column; /* Apila todos los botones en columnas */
                gap: 10px;
            }
            .button-group .upload-button,
            .button-group .llm-feature-button,
            .action-buttons-after-analysis .action-button {
                width: calc(100% - 20px); /* Botón de ancho completo en móvil */
                padding: 12px;
                margin: 0; /* Sin margen lateral */
            }
            .results-area {
                padding: 15px;
            }
            .results-area h2 {
                font-size: 1.2em;
            }
            .evaluation-card, .observations-card {
                padding: 10px;
            }
            .evaluation-card h3, .observations-card h3 {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Contenedor para el logo en el encabezado -->
        <div class="header-logo">
            <img src="https://pbs.twimg.com/profile_images/535655953480175616/D5VRHaDd_400x400.jpeg"
                 alt="Logo de TulaSalud"
                 onerror="this.onerror=null; this.src='https://placehold.co/400x400/8A2BE2/FFFFFF?text=Logo';" />
        </div>

        <h1><i class="fas fa-brain"></i> Analizador Pedagógico TeleEducación - TulaSalud</h1>
        <p>Sube tus archivos PDF, imágenes o presentaciones para un análisis impulsado por IA.</p>

        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Arrastra y suelta tu archivo aquí, o haz click para seleccionar</p>
            <input type="file" id="fileInput" accept=".pdf, image/jpeg, image/png, .ppt, .pptx">
        </div>

        <div class="button-group">
            <button class="upload-button" id="analyzeButton" disabled>Analizar Archivo</button>
        </div>

        <div class="loading-indicator" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Analizando archivo con el Modelo de IA...</p>
        </div>

        <div class="results-area" id="resultsArea" style="display: none;">
            <h2><i class="fas fa-chart-bar"></i> Resultados del Análisis</h2>
            <div id="analysisContent">
                <!-- Las tarjetas se insertarán aquí dinámicamente -->
            </div>
            <!-- Nuevo indicador de carga para las funciones LLM -->
            <div class="llm-loading-indicator" id="llmLoadingIndicator">
                <div class="spinner"></div>
                <p>Generando contenido con IA...</p>
            </div>
            <div id="llmOutput" class="llm-output-section">
                <!-- Aquí se mostrarán los resultados del LLM -->
            </div>
        </div>

        <!-- Nuevos botones de acción que se muestran después del análisis -->
        <div class="action-buttons-after-analysis" id="actionButtons">
            <button class="action-button reset-button" id="resetButton"><i class="fas fa-redo"></i> Cargar otro archivo</button>
            <button class="action-button close-button" id="closePageButton"><i class="fas fa-times-circle"></i> Cerrar Página</button>
        </div>

        <div class="footer">
            <p>© 2025 Lic. Luis Ygnacio Ponce Sierra | Todos los derechos reservados</p>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const analyzeButton = document.getElementById('analyzeButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsArea = document.getElementById('resultsArea');
        const analysisContent = document.getElementById('analysisContent');
        const llmLoadingIndicator = document.getElementById('llmLoadingIndicator');
        const llmOutput = document.getElementById('llmOutput');
        const actionButtons = document.getElementById('actionButtons');
        const resetButton = document.getElementById('resetButton');
        const closePageButton = document.getElementById('closePageButton');
        const container = document.querySelector('.container'); // Referencia al contenedor para mensajes

        let selectedFile = null;

        // Previene el comportamiento por defecto de arrastrar y soltar
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false); // También para el body
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Resalta el área al arrastrar el archivo
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.style.borderColor = '#00BFFF', false);
        });

        // Vuelve al borde normal al salir del área
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.style.borderColor = '#444444', false);
        });

        // Maneja la caída del archivo
        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            // Asegura que solo se procese un archivo
            if (files.length > 0) {
                handleFileSelection(files[0]);
            }
        }

        // Abre el explorador de archivos al hacer click en el área de subida
        uploadArea.addEventListener('click', () => fileInput.click());

        // Maneja la selección de archivos desde el input
        fileInput.addEventListener('change', (e) => {
            // Asegura que solo se procese un archivo
            if (e.target.files.length > 0) {
                handleFileSelection(e.target.files[0]);
            }
        });

        /**
         * Maneja el archivo seleccionado, actualiza el UI y habilita el botón de análisis.
         * Esta función se llama cuando se selecciona un nuevo archivo.
         * @param {File} file - El archivo seleccionado.
         */
        function handleFileSelection(file) {
            selectedFile = file;
            // Muestra el nombre del archivo en el área de subida
            uploadArea.querySelector('p').textContent = `Archivo seleccionado: ${selectedFile.name}`;
            analyzeButton.disabled = false; // Habilita el botón de analizar

            // Resetea el estado de la UI para un nuevo archivo, pero manteniendo el archivo seleccionado
            resultsArea.style.display = 'none';
            llmOutput.innerHTML = '';
            loadingIndicator.style.display = 'none';
            llmLoadingIndicator.style.display = 'none';
            actionButtons.style.display = 'none';
            // Asegura que el área de subida y el botón de análisis estén visibles
            uploadArea.style.display = 'flex';
            analyzeButton.style.display = 'block';
        }

        // Maneja el clic en el botón de analizar
        analyzeButton.addEventListener('click', () => {
            if (selectedFile) {
                startAnalysis(selectedFile);
            } else {
                // Usamos un modal o un mensaje dentro de la página en lugar de alert()
                displayMessage("Por favor, selecciona un archivo para analizar.", "error");
            }
        });

        /**
         * Simula el proceso de análisis inicial de un archivo por una IA.
         * @param {File} file - El archivo a "analizar".
         */
        function startAnalysis(file) {
            // Oculta el área de subida y muestra el indicador de carga
            uploadArea.style.display = 'none';
            analyzeButton.style.display = 'none';
            loadingIndicator.style.display = 'block';
            resultsArea.style.display = 'none'; // Asegura que los resultados estén ocultos
            llmOutput.innerHTML = ''; // Limpia el contenido LLM anterior
            actionButtons.style.display = 'none'; // Oculta los botones de acción mientras se analiza

            // Simula el proceso de análisis inicial
            setTimeout(() => {
                let evaluationContent = '';
                let observationsContent = '';
                let llmButtons = '';

                if (file.type.includes('pdf')) {
                    evaluationContent = `
                        <h3>Evaluación Pedagógica del Contenido</h3>
                        <p><strong>Tipo de Archivo:</strong> Documento PDF</p>
                        <ul>
                            <li><strong>Claridad Conceptual:</strong> <span style="color:#28a745;">Alta.</span> Las definiciones y conceptos clave parecen estar bien explicados.</li>
                            <li><strong>Estructura y Flujo:</strong> <span style="color:#ffc107;">Media.</span> La organización general es lógica, pero algunas transiciones entre secciones podrían ser más fluidas.</li>
                            <li><strong>Complejidad del Lenguaje:</strong> <span style="color:#28a745;">Adecuada.</span> El léxico y la sintaxis son apropiados para un público de jóvenes y adultos, evitando jerga excesiva.</li>
                            <li><strong>Uso de Ejemplos/Analogías:</strong> <span style="color:#ffc107;">Suficiente.</span> Se identifican algunos ejemplos, pero la incorporación de más casos prácticos podría mejorar la comprensión.</li>
                            <li><strong>Relevancia de Elementos Visuales:</strong> <span style="color:#28a745;">Buena.</span> Las imágenes o gráficos detectados apoyan el texto de manera efectiva.</li>
                        </ul>
                    `;
                    observationsContent = `
                        <h3>Observaciones de Mejora (Alineada con políticas educativas guatemaltecas para jóvenes y adultos, así como el perfil de Tele Educación de TulaSalud)</h3>
                        <ul>
                            <li><strong>1. Contextualización Socio-Cultural:</strong> Integrar ejemplos y referencias a la realidad multiétnica, multilingüe y rural de Guatemala, con énfasis en los departamentos meta de TulaSalud (Alta Verapaz, Huehuetenango, Sololá y Quiché), para mejorar la pertinencia y la aplicabilidad.</li>
                            <li><strong>2. Andragogía Aplicada:</strong> Asegurar que el material fomente el aprendizaje autodirigido y se vincule directamente con las experiencias previas y necesidades del personal de salud y la población adulta a la que sirve TulaSalud, pilar fundamental en la educación de personas jóvenes y adultas.</li>
                            <li><strong>3. Relevancia Temática Específica:</strong> Priorizar la inclusión de temas de salud materna, infantil y nutrición, así como la vigilancia epidemiológica, que son pilares de la misión de TulaSalud para la mejora de la cobertura en salud.</li>
                            <li><strong>4. Desarrollo de Competencias Prácticas:</strong> El diseño debe facilitar la mejora continua de las competencias del recurso humano en los servicios de salud, enfocándose en habilidades aplicables directamente en el terreno y relevantes para la atención primaria de salud.</li>
                            <li><strong>5. Adaptabilidad a Brechas de Acceso:</strong> Considerar formatos y metodologías que superen las dificultades de distancia y medios de acceso, utilizando las TIC de manera eficiente para llegar a poblaciones vulnerable y postergada.</li>
                            <li><strong>6. Enfoque Intercultural y de Género:</strong> Asegurar que el contenido sea sensible a las diferencias culturales y de género, promoviendo la equidad y el respeto, como parte fundamental de la formación impulsada por TulaSalud desde sus inicios.</li>
                            <li><strong>7. Claridad y Concisión para Profesionales:</strong> El lenguaje debe ser directo y conciso, optimizado para profesionales de la salud con tiempo limitado, facilitando una rápida asimilación de información crítica relevante para sus competencias.</li>
                            <li><strong>8. Aplicabilidad en Atención Primaria:</strong> Destacar cómo la información y las habilidades presentadas contribuyen directamente a la atención primaria de salud, objetivo clave del proyecto de formación de Auxiliares de Enfermería Comunitaria.</li>
                            <li><strong>9. Fomento de la Retención de Personal:</strong> Si aplica, sugerir elementos que aborden las condiciones de vida y recursos en áreas remotas, contribuyendo a la retención de personal capacitado en las regiones de donde proceden.</li>
                            <li><strong>10. Uso Estratégico de Casos de Éxito:</strong> Incluir historias o casos de éxito concretos de la implementación de E-Salud o capacitaciones de TulaSalud en Guatemala para motivar y mostrar la aplicabilidad del conocimiento en la práctica.</li>
                            <li><strong>11. Módulos de Autoevaluación/Reflexión:</strong> Integrar pequeños ejercicios de autoevaluación o momentos para la reflexión personal, que refuercen el aprendizaje y su vinculación con la práctica diaria, alineado con el fortalecimiento de competencias.</li>
                            <li><strong>12. Promoción de la Colaboración Interinstitucional:</strong> Si el contenido se presta, sugerir cómo el material puede fomentar la coordinación con la Dirección de Recursos Humanos del MSPAS y la Escuela Nacional de Enfermería de Cobán, como lo ha hecho TulaSalud históricamente.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="generateComprehensionQuestions()">Generar Preguntas de Comprensión ✨</button>';
                } else if (file.type.includes('image')) {
                    evaluationContent = `
                        <h3>Evaluación Pedagógica del Contenido</h3>
                        <p><strong>Tipo de Archivo:</strong> Archivo de Imagen (${file.type.split('/')[1].toUpperCase()})</p>
                        <ul>
                            <li><strong>Claridad y Propósito:</strong> <span style="color:#28a745;">Alta.</span> La imagen parece clara y su propósito comunicativo (ilustrar, explicar, decorar) es evidente.</li>
                            <li><strong>Relevancia Contextual:</strong> <span style="color:#ffc107;">Media.</span> La imagen podría ser relevante para el contexto pedagógico, pero su conexión explícita con un tema específico podría fortalecerse con un pie de foto más descriptivo o un texto que la referencie directamente.</li>
                            <li><strong>Calidad y Legibilidad:</strong> <span style="color:#28a745;">Buena.</span> La resolución y el contraste son adecuados. Si contiene texto, este es legible.</li>
                            <li><strong>Impacto Didáctico:</strong> <span style="color:#ffc107;">Potencial.</span> La imagen tiene potencial para ser una herramienta didáctica, pero se beneficiaría de un pequeño análisis de los puntos clave o preguntas que dirijan la atención del estudiante.</li>
                        </ul>
                    `;
                    observationsContent = `
                        <h3>Observaciones de Mejora (Alineada con políticas educativas guatemaltecas para jóvenes y adultos, así como el perfil de Tele Educación de TulaSalud)</h3>
                        <ul>
                            <li><strong>1. Relevancia Cultural y Visual:</strong> Asegurar que las imágenes reflejen la diversidad multiétnica de Guatemala y, si es posible, escenarios relevantes para el personal de salud en áreas rurales y los departamentos meta de TulaSalud.</li>
                            <li><strong>2. Apoyo Visual a Contenidos de Salud Clave:</strong> Las imágenes deben complementar y reforzar los temas de salud materna, infantil, nutrición y vigilancia epidemiológica, que son centrales para TulaSalud.</li>
                            <li><strong>3. Claridad y Comprensibilidad para Acceso Limitado:</strong> La información visual debe ser clara y fácilmente interpretable, incluso para personal con conectividad limitada o dispositivos móviles básicos, facilitando la mejora de cobertura.</li>
                            <li><strong>4. Impacto en la Cobertura y Acceso:</strong> Sugerir el uso de imágenes que simbolicen o muestren la mejora en la cobertura de servicios de salud a poblaciones postergadas a través de la tele-educación.</li>
                            <li><strong>5. Fomento del Enfoque Comunitario:</strong> Evaluar si las imágenes pueden inspirar o mostrar un enfoque comunitario en la prestación de servicios de salud, un pilar de la atención primaria y los programas de TulaSalud.</li>
                            <li><strong>6. Accesibilidad (Descripciones Detalladas):</strong> Proporcionar descripciones "alt text" detalladas para garantizar la accesibilidad a todos los usuarios, en línea con la necesidad de llegar a una población diversa.</li>
                            <li><strong>7. Contexto de Atención Primaria:</strong> Las imágenes deben evocar o ilustrar escenarios de atención primaria de salud, ya que esta es la base de la formación promovida por TulaSalud.</li>
                            <li><strong>8. Aplicabilidad Práctica del Personal:</strong> Las imágenes pueden mostrar procesos de salud, uso de equipos TIC o interacciones paciente-personal relevantes para el desarrollo de competencias prácticas en el uso de E-Salud.</li>
                            <li><strong>9. Simbolismo de Progreso:</strong> Utilizar imágenes que transmitan el impacto positivo de la tele-educación en la mejora de la calidad de vida y la salud en las comunidades guatemaltecas.</li>
                            <li><strong>10. Optimización para Distribución Remota:</strong> Asegurar que las imágenes estén optimizadas en tamaño y formato para una distribución eficiente a través de plataformas de tele-educación, considerando limitaciones de ancho de banda en áreas rurales.</li>
                            <li><strong>11. Coherencia con Mensajes de Prevención:</strong> Si la imagen aborda un tema de salud, debe reforzar mensajes clave de prevención y promoción de la salud materna e infantil.</li>
                            <li><strong>12. Potencial de Interacción y Capacitación:</strong> Si es para un entorno web, considerar la inclusión de "hotspots" interactivos que brinden información adicional sobre elementos específicos de la imagen relevantes para la capacitación del personal.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="generateDetailedImageDescription()">Generar Descripción Detallada ✨</button>';
                } else if (file.type.includes('presentation') || file.type.includes('powerpoint')) {
                    evaluationContent = `
                        <h3>Evaluación Pedagógica del Contenido</h3>
                        <p><strong>Tipo de Archivo:</strong> Presentación (PPT/PPTX)</p>
                        <ul>
                            <li><strong>Estructura Lógica:</strong> <span style="color:#28a745;">Buena.</span> La secuencia de diapositivas parece seguir un orden coherente, con una clara introducción y desarrollo.</li>
                            <li><strong>Densidad de Información por Diapositiva:</strong> <span style="color:#ffc107;">Media.</span> Algunas diapositivas podrían contener demasiada información textual, lo que podría dificultar la retención para la audiencia.</li>
                            <li><strong>Coherencia Visual:</strong> <span style="color:#28a745;">Adecuada.</span> Se observa un estilo visual consistente (fuentes, colores, layouts).</li>
                            <li><strong>Uso de Elementos Multimedia:</strong> <span style="color:#ffc107;">Suficiente.</span> Si hay videos o audios, están bien integrados, pero se podrían explorar más recursos interactivos.</li>
                            <li><strong>Apoyo Visual al Discurso:</strong> <span style="color:#28a745;">Efectivo.</span> Las imágenes y gráficos complementan el mensaje principal de las diapositivas.</li>
                        </ul>
                    `;
                    observationsContent = `
                        <h3>Observaciones de Mejora (Alineada con políticas educativas guatemaltecas para jóvenes y adultos, así como el perfil de Tele Educación de TulaSalud)</h3>
                        <ul>
                            <li><strong>1. Relevancia y Aplicabilidad Local:</strong> Priorizar ejemplos y casos de estudio extraídos de la realidad de los servicios de salud y comunidades rurales en los departamentos meta de TulaSalud, aumentando la pertinencia para el personal.</li>
                            <li><strong>2. Brevedad y Enfoque al Grano:</strong> Dada la carga de trabajo del personal de salud, cada diapositiva debe transmitir su mensaje de forma concisa (máx. 3-5 puntos clave o una idea principal), optimizando el tiempo de capacitación.</li>
                            <li><strong>3. Integración Estratégica de TIC:</strong> Sugerir cómo la presentación puede maximizar el uso de las TIC (imágenes claras, videos cortos de procedimientos, infografías) para una educación efectiva a distancia que mejore la cobertura en salud.</li>
                            <li><strong>4. Fortalecimiento de Competencias Específicas:</strong> El contenido debe estar claramente orientado a mejorar competencias en salud materna, infantil, nutrición, y vigilancia epidemiológica, alineado con los objetivos de TulaSalud.</li>
                            <li><strong>5. Enfoque Intercultural y de Género:</strong> Asegurar que la presentación sea culturalmente pertinente y promueva la equidad de género, adaptándose a la población multiétnica y multilingüe de Guatemala.</li>
                            <li><strong>6. Participación Activa para Adultos:</strong> Diseñar diapositivas con preguntas de reflexión, estudios de caso o pequeños retos que inviten al personal de salud a aplicar lo aprendido en sus contextos.</li>
                            <li><strong>7. Visualización de Datos Clave:</strong> Si se presentan datos (ej. sobre mortalidad), usar gráficos claros y sencillos que comuniquen el mensaje de forma efectiva y accesible, con relevancia para la toma de decisiones en salud.</li>
                            <li><strong>8. Accesibilidad Técnica en Zonas Rurales:</strong> Verificar que la presentación sea compatible con diversas plataformas y dispositivos, incluyendo aquellos con menor capacidad de conexión, para asegurar la accesibilidad en áreas postergadas.</li>
                            <li><strong>9. Promoción de la E-Salud Comunitaria:</strong> Si aplica, resaltar el papel de la presentación en el impulso y apoyo al uso de sistemas comunitarios de E-Salud por el personal de salud.</li>
                            <li><strong>10. Orientación a la Atención Primaria de Salud:</strong> El contenido debe reforzar las prácticas y principios de la atención primaria, base de la formación de Auxiliares de Enfermería Comunitaria y otros profesionales de TulaSalud.</li>
                            <li><strong>11. Mensajes Motivacionales y de Retención:</strong> Incorporar elementos que reconozcan el valor del personal de salud en áreas remotas y que refuercen su compromiso con la misión de TulaSalud, abordando la alta rotación.</li>
                            <li><strong>12. Guía para Facilitadores (si aplica):</strong> Si la presentación es para ser guiada, sugerir la inclusión de notas o recursos para el facilitador que ayuden a contextualizar aún más el contenido para las realidades locales y los objetivos de TulaSalud.</li>
                        </ul>
                    `;
                    llmButtons = '<button class="llm-feature-button" onclick="suggestSpeakerPoints()">Sugerir Puntos Clave para el Orador ✨</button>';
                } else {
                    evaluationContent = `<p><strong>Tipo de Archivo:</strong> Tipo de archivo desconocido</p><p>Lo siento, el Analizador Pedagógico TeleEducación no puede procesar este tipo de archivo en este momento. Por favor, sube un PDF, una imagen o una presentación (PPT/PPTX).</p>`;
                    observationsContent = ''; // No hay observaciones si no se puede procesar el archivo
                }

                // Oculta el indicador de carga principal y muestra los resultados
                loadingIndicator.style.display = 'none';
                
                // Estos elementos solo se muestran DESPUÉS de que el análisis inicial haya terminado
                uploadArea.style.display = 'flex'; 
                analyzeButton.style.display = 'block'; 
                analyzeButton.disabled = true; // Deshabilita hasta nueva selección
                uploadArea.querySelector('p').textContent = 'Arrastra y suelta tu archivo aquí, o haz click para seleccionar'; 
                fileInput.value = ''; 
                selectedFile = null; // Reinicia el archivo seleccionado para evitar re-análisis sin nueva selección

                // Insertar las tarjetas en el analysisContent
                analysisContent.innerHTML = `
                    <div class="evaluation-card">
                        ${evaluationContent}
                    </div>
                    <div class="observations-card">
                        ${observationsContent}
                    </div>
                    <div class="llm-feature-buttons button-group">
                        ${llmButtons}
                    </div>
                `;
                resultsArea.style.display = 'block'; 
                actionButtons.style.display = 'flex'; 
            }, 3000); // Simula un retraso de 3 segundos para el análisis inicial
        }

        /**
         * Simula la generación de preguntas de comprensión con un LLM (para PDF).
         */
        function generateComprehensionQuestions() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const questions = [
                    "¿Cómo se relaciona el objetivo principal de este documento con la misión de TulaSalud de reducir la mortalidad materna e infantil en los departamentos meta de Alta Verapaz, Huehuetenango, Sololá y Quiché?",
                    "Explica con tus propias palabras dos conceptos clave presentados y cómo el personal de salud en áreas rurales, multiétnicas y multilingües de Guatemala podría aplicarlos para mejorar la atención primaria.",
                    "Identifica un ejemplo o caso práctico. ¿Cómo podría este ejemplo ser adaptado o enriquecido para reflejar la realidad específica de una comunidad rural guatemalteca, considerando las dificultades de acceso?",
                    "Según el documento, ¿qué elementos visuales serían más efectivos para un Auxiliar de Enfermería Comunitaria capacitado por TulaSalud, considerando su contexto de tele-educación y la importancia de la nutrición en estas poblaciones?",
                    "Si tuvieras que mejorar una sección de este documento para que se alinee más con las directrices de Tele Capacitación de TulaSalud sobre salud reproductiva y el fortalecimiento de competencias del personal, ¿qué cambio harías?",
                    "¿Qué preguntas adicionales te surgen sobre cómo este contenido podría ser implementado para fortalecer las competencias del personal de salud en el uso de las TIC para la vigilancia epidemiológica en zonas postergadas?",
                    "¿De qué manera la estructura del documento promueve (o podría promover mejor) la formación a distancia con un enfoque intercultural y de género, tan crucial para TulaSalud?",
                    "Si este documento fuera parte de un diplomado de TulaSalud, ¿qué tipo de actividad práctica sugerirías para asegurar que los participantes apliquen el conocimiento directamente en los servicios de salud en sus regiones de origen?",
                    "¿Qué tipo de recurso complementario (ej. un micro-video de un caso real de atención materna en Huehuetenango o una infografía sobre nutrición adaptada a la dieta local) crees que sería más útil para este documento, alineado con el uso de TIC de TulaSalud?",
                    "Identifica una fortaleza clave en el diseño de la información que facilite el aprendizaje y contribuya directamente a la mejora de la cobertura en salud y las capacidades del MSPAS para la población materno-infantil y niños menores de cinco años."
                ];
                let output = '<h3>Preguntas de Comprensión Sugeridas por IA ✨</h3><ul>';
                questions.forEach(q => { output += `<li>${q}</li>`; });
                output += '</ul><p><em>Estas preguntas buscan evaluar la comprensión profunda y crítica del contenido, con un enfoque en la relevancia para jóvenes y adultos y la alineación con las políticas educativas guatemaltecas y el perfil de Tele Educación de TulaSalud.</em></p>';
                llmOutput.innerHTML = output;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso de 2.5 segundos para la generación de preguntas
        }

        /**
         * Simula la generación de una descripción detallada de imagen con un LLM.
         */
        function generateDetailedImageDescription() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const description = `
                    <h3>Descripción Detallada de Imagen Sugerida por IA ✨</h3>
                    <p>La IA interpreta esta imagen como una representación altamente conceptual de un entorno de aprendizaje dinámico, probablemente en el ámbito de la teleeducación. Se observa una paleta de colores que evoca profesionalismo y claridad, con elementos que sugieren interconexión y flujo de información.</p>
                    <p><strong>Análisis Pedagógico Visual (Alineada con políticas educativas guatemaltecas para jóvenes y adultos, así como el perfil de Tele Educación de TulaSalud):</strong></p>
                    <ul>
                        <li><strong>Propósito Didáctico en Tele-Educación:</strong> La imagen sirve como metáfora visual para el proceso de aprendizaje digital, enfatizando la interacción de ideas y la conectividad, fundamental para la modalidad a distancia de TulaSalud y la mejora de cobertura en salud.</li>
                        <li><strong>Relevancia para la Audiencia de TulaSalud:</strong> Su diseño moderno y limpio puede ser atractivo para el personal de salud (auxiliares de enfermería, técnicos en salud rural, médicos), sugiriendo un enfoque innovador en la capacitación a distancia.</li>
                        <li><strong>Contextualización Regional (Guatemala):</strong> Aunque abstracta, esta imagen podría complementarse con elementos visuales sutiles que la conecten a la realidad de las comunidades multiétnicas, multilingües y rurales de los departamentos meta de TulaSalud (Alta Verapaz, Huehuetenango, Sololá o Quiché) para mayor identificación.</li>
                        <li><strong>Fomento del Uso de TIC para Competencias:</strong> La imagen visualiza un flujo de información digital, lo cual refuerza el mensaje de TulaSalud sobre el uso de las TIC para mejorar las competencias del recurso humano en salud y apoyar el uso de sistemas de E-Salud.</li>
                        <li><strong>Impacto en la Salud Materna e Infantil:</strong> Se puede interpretar como la interconexión de datos y conocimientos que, a través de la tele-capacitación, contribuye a la reducción de la mortalidad materna e infantil, y al aumento de la capacidad del MSPAS.</li>
                        <li><strong>Accesibilidad Visual:</strong> La simplicidad de las formas y los contrastes de color facilitan la percepción visual, importante para el personal que podría acceder a los materiales en diversas condiciones y con posibles limitaciones de infraestructura.</li>
                        <li><strong>Potencial de Discusión:</strong> La imagen puede ser un excelente punto de partida para discutir cómo las tecnologías superan las barreras geográficas y de acceso, facilitando el conocimiento y la interconexión en el aprendizaje a distancia para el personal de salud en zonas remotas.</li>
                    </ul>
                    <p><strong>Sugerencias para el uso óptimo en Tele Capacitación de TulaSalud:</strong></p>
                    <ul>
                        <li>Integrar con un texto que la referencie explícitamente, explicando su metáfora visual en el contexto de la mejora de servicios de salud a través de la tele-educación, con énfasis en la atención primaria y la población vulnerable en Guatemala.</li>
                        <li>Considerar animación sutil si se usa en un entorno web para reforzar la idea de dinamismo y flujo de información en la vigilancia epidemiológica o la capacitación continua.</li>
                        <li>Utilizarla como punto de partida para una discusión sobre cómo la "arquitectura" del conocimiento en línea empodera al personal de salud en las regiones de TulaSalud para servir mejor a la población.</li>
                        <li>Si se busca ilustrar temas específicos de salud (materna, infantil, nutrición), complementar con imágenes de casos de éxito o escenarios reales que resuenen con la experiencia del personal de salud en las comunidades guatemaltecas.</li>
                    </ul>
                `;
                llmOutput.innerHTML = description;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso
        }

        /**
         * Simula la sugerencia de puntos clave para el orador con un LLM (para PPT).
         */
        function suggestSpeakerPoints() {
            llmLoadingIndicator.style.display = 'block';
            llmOutput.innerHTML = ''; // Limpiar salida anterior

            setTimeout(() => {
                const points = [
                    "<strong>Diapositiva 1 (Título):</strong> 'Bienvenidos a la Tele Capacitación de TulaSalud: Mejorando la Salud Materna e Infantil en Guatemala'. Conectar con la misión central y el impacto directo en las comunidades de los departamentos meta (Alta Verapaz, Huehuetenango, Sololá y Quiché).",
                    "<strong>Diapositiva 2 (Agenda y Beneficios):</strong> 'Lo que aprenderán hoy para fortalecer sus competencias y mejorar la cobertura en salud'. Destacar cómo la capacitación contribuirá directamente a los objetivos de TulaSalud y del MSPAS para madres y niños.",
                    "<strong>Diapositva 3 (El Desafío Guatemalteco):</strong> 'Superando barreras: la salud en poblaciones multiétnicas, multilingües, rurales y postergadas'. Contextualizar el problema que TulaSalud aborda con la tele-educación, haciendo énfasis en las dificultades de acceso.",
                    "<strong>Diapositiva 4 (Nuestro Enfoque - Tele-Educación):</strong> 'Cómo TulaSalud utiliza las TIC para el desarrollo de competencias en salud a distancia y el impulso de la E-Salud'. Explicar la metodología y sus ventajas para el personal en ejercicio (Auxiliares de Enfermería, Técnicos, Médicos).",
                    "<strong>Diapositiva 5 (Temas Clave de TulaSalud):</strong> 'Profundizando en salud materna, infantil, nutrición y vigilancia epidemiológica'. Desglosar los contenidos esenciales, vinculándolos con la práctica diaria del personal de salud en la atención primaria.",
                    "<strong>Diapositiva 6 (Casos de Éxito y Lecciones Aprendidas):</strong> 'El impacto en la práctica: Ejemplos de nuestros departamentos meta'. Presentar casos reales de éxito de TulaSalud o sus colaboradores en la reducción de mortalidad o mejora de servicios en Alta Verapaz, Huehuetenango, Sololá o Quiché.",
                    "<strong>Diapositiva 7 (Uso de Tecnología para Vigilancia Epidemiológica):</strong> 'Fortaleciendo la E-Salud comunitaria y la recopilación de datos para la toma de decisiones'. Explicar cómo el equipamiento y la capacitación en TIC apoyan la vigilancia y el acceso a servicios básicos.",
                    "<strong>Diapositiva 8 (Enfoque Intercultural y de Género):</strong> 'Atención con pertinencia cultural y equidad para nuestra población diversa'. Abordar cómo la formación respeta y se adapta a la diversidad de las comunidades guatemaltecas, un pilar fundamental de TulaSalud.",
                    "<strong>Diapositiva 9 (Preguntas y Aplicación Práctica):</strong> 'Aplicando lo aprendido: Preguntas y escenarios clínicos basados en la realidad local'. Fomentar la discusión y la resolución de problemas basados en la experiencia del personal y los desafíos reales.",
                    "<strong>Diapositiva 10 (Sostenibilidad y Futuro de la Capacitación):</strong> 'El camino hacia la mejora continua: el compromiso de TulaSalud y el rol del personal'. Inspirar al personal sobre el impacto a largo plazo de su formación y su papel en el fortalecimiento del MSPAS.",
                    "<strong>Diapositiva 11 (Agradecimientos y Compromiso):</strong> '¡Gracias por su compromiso con la salud de Guatemala y con la misión de TulaSalud!'. Reconocer el valor del personal de salud y su rol crucial en la atención a la población vulnerable.",
                    "<strong>Diapositiva 12 (Recursos y Contacto):</strong> 'Recursos adicionales para su formación y apoyo continuo en el uso de las TIC y los servicios de salud'. Proporcionar enlaces a materiales de apoyo y formas de contacto para asistencia técnica continua, como parte de la estrategia de TulaSalud."
                ];
                let output = '<h3>Puntos Clave para el Orador Sugeridos por IA ✨</h3><ul>';
                points.forEach(q => { output += `<li>${q}</li>`; });
                output += '</ul><p><em>Estas preguntas buscan evaluar la comprensión profunda y crítica del contenido, con un enfoque en la relevancia para jóvenes y adultos en el contexto guatemalteco, alineado con las políticas educativas guatemaltecas y el perfil de Tele Educación de TulaSalud.</em></p>';
                llmOutput.innerHTML = output;
                llmLoadingIndicator.style.display = 'none';
            }, 2500); // Simula un retraso
        }

        /**
         * Reinicia el estado de la UI a su condición inicial para permitir la carga de un nuevo archivo.
         */
        function resetUIState() {
            selectedFile = null; // Resetea el archivo seleccionado
            fileInput.value = ''; // Limpia el valor del input de archivo
            uploadArea.querySelector('p').textContent = 'Arrastra y suelta tu archivo aquí, o haz click para seleccionar'; // Restablece el texto del área de subida
            analyzeButton.disabled = true; // Deshabilita el botón de analizar
            resultsArea.style.display = 'none'; // Oculta la sección de resultados
            llmOutput.innerHTML = ''; // Limpia el contenido generado por LLM
            loadingIndicator.style.display = 'none'; // Oculta el indicador de carga principal
            llmLoadingIndicator.style.display = 'none'; // Oculta el indicador de carga del LLM
            actionButtons.style.display = 'none'; // Oculta los botones de acción post-análisis
        }

        // Event listeners para los nuevos botones de acción
        resetButton.addEventListener('click', resetUIState); // Botón para cargar otro archivo (reinicia la UI)

        closePageButton.addEventListener('click', () => {
            // Intenta cerrar la ventana/pestaña del navegador.
            // Nota: La mayoría de los navegadores modernos restringen esta función
            // por seguridad, a menos que la ventana haya sido abierta por script.
            window.close();
        });

        // Función para mostrar mensajes personalizados (en lugar de alert)
        function displayMessage(message, type = "info") {
            // Eliminar cualquier mensaje existente para evitar duplicados
            const existingMessageBox = container.querySelector('.message-box');
            if (existingMessageBox) {
                existingMessageBox.remove();
            }

            // Crear un div para el mensaje
            const messageBox = document.createElement('div');
            messageBox.textContent = message;
            messageBox.className = 'message-box'; // Añadir una clase para facilitar la selección

            messageBox.style.padding = '15px';
            messageBox.style.borderRadius = '8px';
            messageBox.style.marginTop = '20px';
            messageBox.style.color = '#fff';
            messageBox.style.fontWeight = 'bold';
            messageBox.style.textAlign = 'center';

            if (type === "error") {
                messageBox.style.backgroundColor = '#DC3545'; // Rojo para errores
            } else {
                messageBox.style.backgroundColor = '#007BFF'; // Azul para información
            }

            // Añadir al contenedor principal
            container.insertBefore(messageBox, uploadArea.nextSibling); // Insertar después del área de carga

            // Eliminar el mensaje después de unos segundos
            setTimeout(() => {
                messageBox.remove();
            }, 5000);
        }
    </script>
</body>
</html>
